<!DOCTYPE HTML>
<!--
	Slate by Pixelarity
	pixelarity.com | hello@pixelarity.com
	License: pixelarity.com/license
-->
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<title>Fit Hub</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<noscript><link rel="stylesheet" th:href="@{/assets/css/noscript.css}" /></noscript>
	<link rel="stylesheet" th:href="@{/assets/css/index.css}" />
	<link rel="stylesheet" th:href="@{/assets/css/sidebar.css}" />
	<link rel="stylesheet" th:href="@{/assets/css/common.css}" />

</head>
<style>

</style>
<body class="is-preload">


<!-- Header -->
<th:block th:replace="~{layout/header::header(${session.loginUser},${session.user},${session.trainer},${session.admin})}"></th:block>

<!-- Main -->
<section id="main" class="wrapper sidebar left">

	<div class="header_box">
		<header class="test12">
			<p id="mainText">마이페이지</p>
			<p id="subText">북마크</p>
		</header>
	</div>

	<div class="inner">


		<!-- Content -->
		<div class="content">
			<div id="boardInfo" class="button cate now_cate" style="margin-right: 10px;">정보게시판</div>
			<div id="boardProduct" class="button cate not_cate" style="margin-right: 10px;">제품추천게시판</div>
			<!-- 게시글 리스트 띄우는 테이블 -->
			<table class="list">
				<thead id="data-table-head">

				</thead>
					<tr align="center" valign="middle">
						<th class="long_text">북마크번호</th>
						<th class="long_text">게시판번호</th>
						<th class="long_text">제목</th>
						<th class="long_text">작성자</th>
						<th class="long_text">날짜</th>
						<th class="long_text">조회수</th>
					</tr>
				<tbody id="data-table">

				</tbody>
			</table><!-- 페이징 처리하는 테이블 -->
			<table class="pagination">
				<tr align="center" valign="middle">
					<td>
						<a class="changePage" th:if="${pageMaker.prev}" th:href="${pageMaker.startPage-1}">&lt;</a>
						<th:block th:each="i : ${#numbers.sequence(pageMaker.startPage,pageMaker.endPage)}">
							<span class="nowPage" th:text="${i}" th:if="${pageMaker.cri.pagenum == i}"></span>
							<a class="changePage" th:href="${i}" th:text="${i}" th:unless="${pageMaker.cri.pagenum == i}"></a>
						</th:block>
						<a class="changePage" th:if="${pageMaker.next}" th:href="${pageMaker.endPage+1}">&gt;</a>
					</td>
				</tr>
			</table>
			<!-- 글쓰기 버튼 배치하는 테이블 -->

			<form id="searchForm" th:action="@{/usermypage/user_subbookmark}">
				<div class="search_area">
					<select name="type">
						<option value="" th:selected="${pageMaker.cri.type == null}">검색</option>
						<option value="T" th:selected="${pageMaker.cri.type == 'T'}">제목</option>
						<option value="C" th:selected="${pageMaker.cri.type == 'C'}">내용</option>
						<option value="W" th:selected="${pageMaker.cri.type == 'W'}">작성자</option>
						<option value="TC" th:selected="${pageMaker.cri.type == 'TC'}">제목 또는 내용</option>
						<option value="TW" th:selected="${pageMaker.cri.type == 'TW'}">제목 또는 작성자</option>
						<option value="TCW" th:selected="${pageMaker.cri.type == 'TCW'}">제목 또는 내용 또는 작성자</option>
					</select>
					<input type="text" name="keyword" id="keyword" th:value="${pageMaker.cri.keyword}">
					<a href="#" class="button primary">검색</a>
				</div>
				<input type="hidden" value="1" name="pagenum">
				<input type="hidden" value="10" name="amount">
			</form>
		</div>

		<form name="pageForm" id="pageForm" th:action="@{/usermypage/user_subbookmark}">
			<input type="hidden" name="pagenum" th:value="${pageMaker.cri.pagenum}">
			<input type="hidden" name="amount" th:value="${pageMaker.cri.amount}">
			<input type="hidden" name="type" th:value="${pageMaker.cri.type}">
			<input type="hidden" name="keyword" th:value="${pageMaker.cri.keyword}">
		</form>

		<!-- Sidebar -->
		<div class="sidebar">
			<section>
				<div class="boardRanking">
					<div class="boardRanking_ranking">
						<table style="width: 90%;">
							<tr><td><a href="/usermypage/user_myinfo">내 정보 수정</a></td></tr>
							<tr><td><a href="/usermypage/user_diary">나의 다이어리</a></td></tr>
							<tr><td><a href="/usermypage/user_challenge">나의 챌린지</a></td></tr>
							<tr><td><a href="/usermypage/user_subtrainer">구독한 트레이너</a></td></tr>
							<tr><td><a href="/usermypage/user_subbookmark" style="color: #5a8100; font-size: 20px;">북마크</a></td></tr>
							<tr><td><a href="/usermypage/user_boardlist">내 게시물</a></td></tr>
							<tr><td><a href="/usermypage/user_messagelist">쪽지함</a></td></tr>
							<tr><td><a href="/usermypage/user_myprofile">나의 프로필</a></td></tr>
							<tr><td><a href="/usermypage/user_applytrainer">트레이너 전환 신청</a></td></tr>
						</table>
					</div>
				</div>
			</section>
		</div>

	</div>
</section>

<!-- Footer -->
<th:block th:replace="~{layout/footer::footer}"></th:block>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script th:src="@{/assets/js/jquery.dropotron.min.js}"></script>
<script th:src="@{/assets/js/jquery.scrollex.min.js}"></script>
<script th:src="@{/assets/js/browser.min.js}"></script>
<script th:src="@{/assets/js/breakpoints.min.js}"></script>
<script th:src="@{/assets/js/util_sub.js}"></script>
<script th:src="@{/assets/js/main_sub.js}"></script>

<script th:src="@{/assets/js/sidebar.js}"></script>

<script th:inline="javascript">
	const cate = document.querySelectorAll('.cate');
	let nowCate = document.querySelector('.now_cate');

	cate.forEach(function(btn) {
		btn.addEventListener('click', function() {
			if (btn.classList.contains('now_cate')) {
			 return;
			}

			btn.classList.remove('not_cate');
			btn.classList.add('now_cate');

			nowCate.classList.remove('now_cate');
			nowCate.classList.add('not_cate');

			nowCate = btn;
		});
	});

	$(document).ready(function() {
		const searchForm = $("#searchForm");
        let keyword = searchForm.find("option:selected").val();
		let type = searchForm.find("input[name='keyword']").val();
        let category = 'board_info';
        loadPage('/usermypage/board_info', 1);

        $('#boardInfo').click(function() {
            category = 'board_info';
			keyword = searchForm.find("option:selected").val();
			type = searchForm.find("input[name='keyword']").val();
            loadPage('/usermypage/board_info', 1, keyword, type);
        });

        $('#boardProduct').click(function() {
            category = 'board_product';
            keyword = searchForm.find("option:selected").val();
			type = searchForm.find("input[name='keyword']").val();
            loadPage('/usermypage/board_product', 1, keyword, type);
        });


        // 페이지 데이터를 불러오는 함수
        function loadPage(url, pageNum, keyword, type) {
            $.ajax({
                url: url,
                data: { pageNum: pageNum, category: category , keyword, type},
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    // 게시글 목록 업데이트
                    displayData(data);
                    // 페이징 버튼 업데이트
                    displayPaging(data.pageDTO);
                },
                error: function (error) {
                    console.error('데이터를 가져오는 중 오류 발생: ' + error);
                }
            });
        }




        function displayPaging(pageDTO) {
            var startPage = pageDTO.startPage;
            var endPage = pageDTO.endPage;
            var prev = pageDTO.prev;
            var next = pageDTO.next;

            var str = '';

            if (prev) {
                str += '<a class="changePage" href="' + (startPage - 1) + '"><code>&lt;</code></a>';
            }

            for (var i = startPage; i <= endPage; i++) {
                if (i === pageDTO.cri.pagenum) {
                    str += '<span class="nowPage">' + i + '</span> ';
                } else {
                    str += '<a class="changePage" href="' + i + '">' + i + '</a>';
                }
            }

            if (next) {
                str += '<a class="changePage" href="' + (endPage + 1) + '"><code>&gt;</code></a>';
            }

            var page = $('.pagination');
            page.html('<tr align="center" valign="middle"><td>' + str + '</td></tr>');

            // 페이지 버튼 클릭 이벤트를 연결
            $(".changePage").on("click", function (e) {
                e.preventDefault(); // 기본 동작 중지


				let keyword = searchForm.find("option:selected").val();
				let type = searchForm.find("input[name='keyword']").val();
                var pageNum = $(this).attr('href');
                loadPage('/usermypage/' + category, pageNum, keyword, type);
            });
        }


		function displayData(data) {
			var tableHead = $('#data-table-head');
			tableHead.empty();
			var tableBody = $('#data-table');
			tableBody.empty();


			var headRow = $('<tr align="right" valign="middle">');
			headRow.append('<td colspan="6">글 개수 : '+data.pageDTO.total+'</td>');
			tableHead.append(headRow);

			if (data.list != null && data.list.length > 0) {
				data.list.forEach(function (board) {
					var row = $('<tr>');
					row.append('<td class="long_text">x</td>');
					row.append('<td class="long_text">' + board.boardNum + '</td>');
					row.append('<td class="long_text">' + board.boardTitle+ '</td>');
					row.append('<td class="long_text"><a href="#" class="open">' + board.userId + '</td>');
					row.append('<td class="long_text">' + board.regdate + '</td>');
					row.append('<td class="long_text">' + board.viewCnt + '</td>');
					tableBody.append(row);
				});
			}
			else {
				tableBody.append('<tr><td colspan="6">등록된 게시글이 없습니다.</td></tr>');
			}
            $(".open").on("click", function (e) {
                e.preventDefault();
				var userId = $(this).text();

				sendUserIdToModal(userId);
                modalBox.classList.add("active");
            });
		}
	});


	const searchForm = $("#searchForm");
	$("#searchForm a").on("click",sendit);
	function sendit(){
		if(!searchForm.find("option:selected").val()){
			alert("검색 기준을 선택하세요!");
			return false;
		}
		if(!document.getElementById("keyword").value){
			alert("키워드를 입력하세요!");
			return false;
		}
		$(".now_cate").click()
	}
</script>
</body>
</html>