<!DOCTYPE HTML>
<!--
	Slate by Pixelarity
	pixelarity.com | hello@pixelarity.com
	License: pixelarity.com/license
-->
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Fit Hub</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="stylesheet" th:href="@{/assets/css/index.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/sidebar.css}"/>
    <noscript>
        <link rel="stylesheet" th:href="@{/assets/css/noscript.css}"/>
    </noscript>

    <script th:src="@{/assets/js/diaryWrite.js}"></script>
    <script th:src="@{/assets/js/jquery.min.js}"></script>
    <script th:src="@{/assets/js/jquery.dropotron.min.js}"></script>
    <script th:src="@{/assets/js/jquery.scrollex.min.js}"></script>

    <script>
        function weighsum(e) {

            const weightGoalNum = document.querySelector("#weightGoal").value;
            const weightGoal = weightGoalNum.slice(0, -2);

            if (48 <= window.event.keyCode && window.event.keyCode <= 57 || window.event.keyCode == 8) {


                const todayweigh = document.querySelector("#todayweigh");

                let resultweigh = Number(weightGoal) - Number(todayweigh.value);

                document.querySelector("#resultweigh").value = resultweigh;
            } else {
                alert("숫자만 입력하세요")
                document.querySelector("#todayweigh").value = "";

            }

        }
    </script>

    <!-- summernote   -->
    <!--    <script src="/assets/js/summernote/summernote-lite.js"></script>-->
    <!--    <script src="/assets/js/summernote/lang/summernote-ko-KR.js"></script>-->
    <!--    <link rel="stylesheet" href="/assets/css/summernote/summernote-lite.css">-->

    <!--    모달 박스-->
    <link rel="stylesheet" th:href="@{/assets/css/searchModal.css}"/>

    <noscript>
        <link rel="stylesheet" th:href="@{/assets/css/noscript.css}"/>
    </noscript>
</head>
<style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;

    }

    .td {
        /* background-color: white !important; */
    }

    /* MAIN IMG 게시글 상단 고정 */
    #top_main_img {
        width: 100%;
        height: 250px;
        border: 1px solid red;
    }

    #container1 {
        margin: 0 auto;
        width: 1080px;
        height: 100%;
        display: flex;
        justify-content: center;
    }

    /* #container1::after{
        clear: both;
    } */
    #container1 #side_box {
        /* float: left; */
        width: 310px;
        height: 100%;
        border: 1px solid violet;
        /* background-color: antiquewhite; */
    }

    #container1 #main_box {
        /* float: left; */
        height: 100%;
        width: 770px;
        /* border: 1px solid violet; */
        /* background-color: yellowgreen; */
    }

    /* 사이드 카테고리  */
    #container1 #side_box .cate_list {
        list-style: none;
    }

    #container1 #side_box .cate_list li {
        margin: 30px;

    }

    .diary_write {
        margin: 20px;
    }

    .input_area {
        display: flex;
        justify-content: space-between;
    }

    .list_area {
        height: 100px;
        border: 1px solid green;
        margin-top: 20px;
        border-radius: 10px;
    }

    /*.list_area input[type=button]{*/
    /*  height: 30px;*/
    /*  line-height: 30px;*/
    /*}*/

    .total_area {
        display: flex;
        justify-content: space-between;
    }

    .diary_contents {
        resize: none;
    }

    .box_flex {
        display: flex;
        justify-content: space-between;
    }

    td div > input[type=text]:nth-child(2), td div > input[type=text]:nth-child(3) {
        text-align: right;
    }


    td .input_area > input[type=button]:last-child {
        width: 30px;
        background: url(/images/addbutton.png) no-repeat;
        background-size: 50% 50%;
        background-position: center;
        /* box-shadow: inset 0 0 0 2px #5a810086; */
    }

    .food_area div:last-child input[type=button] {
        width: 100%;
        margin-top: 10px;
        border-radius: 5px;
    }

    .ex_area div:last-child input[type=button] {
        width: 100%;
        margin-top: 10px;
        border-radius: 5px;
    }

    /* 추가한 css */
    table tbody tr:nth-child(2n + 1) {
        background-color: white;

    }

    td div > input[type=button] {
        box-shadow: inset 0 0 0 2px #e6e6e6;
    }

    .food_area .list_area {
        text-align: center;
        padding: 10px;
        display: block;
        height: 100px;

    }

    .excrcise_list.list_area {
        text-align: center;
        padding: 10px;
        display: block;
        height: 100px;
    }

    .total_area input[type=text] {
        text-align: center !important;
    }

    .total_area #carbo, .total_area #protein, .total_area #fat {
        text-align: right !important;
    }


</style>
<body class="is-preload">

<!-- Header -->
<th:block th:replace="~{layout/headerNoneModal::header(${session.loginUser})}"></th:block>
<th:block th:replace="~{layout/searchModal::searchModal()}"></th:block>

<div id="top_main_img">
    이미지 추가 예정
</div>

<div id="container1">
    <div id="side_box">
        <div>마이페이지</div>
        <div>
            <ul class="cate_list">
                <li>프로필</li>
                <li>나의 다이어리</li>
                <li>나의 챌린지</li>
                <li>나의 트레이너</li>
                <li>북마크</li>
                <li>내가 쓴 게시글</li>
                <li>내 정보 수정</li>
            </ul>
        </div>
    </div>

    <div id="main_box">
        <form id="diaryForm" action="" method="post">

            <table class="diary_write">
                <tr>
                    <td><input type="text" name="writeDate" th:value="${regdate}" readonly onfocus="this.blur();"></td>
                    <td><input type="text" name="nicname" th:value="${user.userNickname}" readonly
                               onfocus="this.blur();"></td>
                </tr>
                <tr>
                    <!-- <td></td> -->
                    <td colspan="2"><input type="text" name="title" id="" value="제목"></td>
                </tr>
                <tr>
                    <!-- <td></td> -->
                    <td colspan="2">
                        <div class="weight_area box_flex">
                            <div><input type="text" value="목표 체중" readonly onfocus="this.blur();"></div>

                            <div><input type="text" name="weightGoal" id="weightGoal" value="50kg"></div>

                            <div><input type="text" value="현재 체중" readonly onfocus="this.blur();"></div>

                            <div><input type="text" name="todayweigh" id="todayweigh"
                                        placeholder="0" onfocus="this.placeholder = ''" onkeyup="weighsum()"></div>

                            <div><input type="text" value="kg" readonly onfocus="this.blur();"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div class="weight_result box_flex">
                            <div><input type="text" value="오늘의 비교" readonly onfocus="this.blur();"></div>
                            <div><input type="text" id="resultweigh" name="resultweigh" value="0" readonly></div>
                            <div><input type="text" value="kg" readonly></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="food_area">
                        <div class="bf_input input_area">
                            <input type="text" value="아침" readonly>
                            <input type="hidden" name="todayBf" id="todayBf">
                            <input type="text" id="bfCal" value="0" readonly>
                            <input type="text" value="kcal" readonly>
                            <input type="button" class="opensearch">
                        </div>
                        <input type="text" class="bf_list list_area" id="bf_result" readonly onfocus="this.blur();">

                        <div><input type="button" value="전체 삭제" onclick="removebf()"></div>
                        <!--                        <input type="text" name="todayBf"  readonly>-->
                    </td>
                    <td class="food_area">
                        <div class="lunch_input input_area">
                            <input type="text" value="점심" readonly>
                            <input type="hidden" name="todaylunch">
                            <input type="text" id="lunchCal" value="0" readonly>
                            <input type="text" value="kcal" readonly>
                            <input type="button" class="opensearch">
                        </div>
                        <input type="text" class="bf_list list_area" id="lunch_result">
                        <div><input type="button" value="전체 삭제" onclick="removelunch()"></div>
                        <!--                        <input type="text" name="todaylunch" readonly >-->
                    </td>
                </tr>
                <tr>
                    <td class="food_area">
                        <div class="dinner_input input_area">
                            <input type="text" value="저녁" readonly>
                            <input type="hidden" name="todaydinner">
                            <input type="text" id="dinnerCal" value="0" readonly>
                            <input type="text" value="kcal" readonly>
                            <input type="button" class="opensearch">
                        </div>
                        <input type="text" class="bf_list list_area" id="dinner_result">

                        <div><input type="button" value="전체 삭제" onclick="removedinner()"></div>
                        <!--                        <input type="text" name="todaydinner">-->
                    </td>
                    <td class="food_area">
                        <div class="snack_input input_area">
                            <input type="text" value="간식" readonly>
                            <input type="hidden" name="todaysnack">
                            <input type="text" id="snackCal" value="0" readonly>
                            <input type="text" value="kcal" readonly>
                            <input type="button" class="opensearch">
                        </div>
                        <input type="text" class="bf_list list_area" id="snack_result">

                        <div><input type="button" value="전체 삭제" onclick="removesnack()"></div>
                        <!--                        <input type="text" name="todaysnack">-->
                    </td>
                </tr>
                <tr>
                    <!-- <td></td> -->
                    <td colspan="2" class="ex_area">
                        <div class="ex_input input_area">
                            <input type="text" value="운동" readonly>
                            <input type="hidden" name="todayExcrcise">
                            <input type="text" id="exerCal" value="0" readonly>
                            <input type="text" value="kcal" readonly style="text-align: left;">
                            <input type="button" class="opensearch">
                        </div>
                        <input type="text" class="excrcise_list list_area" id="exer_result">

                        <div><input type="button" value="전체 삭제" onclick="removeexer()"></div>
                        <!--                        <input type="text" name="todayExcrcise">-->
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div class="total_area" style="text-align: center">
                            <input type="button" onclick="totalsum()" value="최종 칼로리" style="margin-right: 15px">
                            <input type="text" id="totalFood" value="총 음식칼로리" readonly>
                            <input type="text" value="-" readonly>
                            <input type="text" id="totalexer" value="총 운동칼로리" readonly>
                            <input type="text" value="=" readonly>
                            <input type="text" id="totalResult" value="0kcal" readonly>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div class="total_area" style="text-align: center">
                            <input type="text" value="목표 칼로리" readonly>
                            <input type="text" th:value="${user.caloriesGoal}+kcal" id="caloriesGoal" readonly>
                            <input type="text" value="-" readonly>
                            <input type="text" id="totalCal" value="오늘 칼로리" readonly>
                            <input type="text" value="=" readonly>
                            <input type="text" id="todayCal" value="0kcal" readonly>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td colspan="2">
                        <div class="total_area" style="display: flex; justify-content: space-between">
                            <input type="text" value="탄수화물" readonly>
                            <input type="text" id="carbo" value="0g" readonly>

                            <input type="text" value="단백질" readonly>
                            <input type="text" id="protein" value="0g" readonly>

                            <input type="text" value="지방" readonly>
                            <input type="text" id="fat" value="0g" readonly>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <textarea name="diaryContents" class="diary_contents" cols="30" rows="10" id="summernote"
                                  placeholder="내용을 입력해 주세요."></textarea>
                    </td>
                </tr>

                <tr class="mychall_area">
                    <td>
                        <label><input type="checkbox" name="challBox" value="챌린지num">챌린지name</label>
                    </td>
                    <td>
                        <label><input type="checkbox" name="challBox" value="챌린지num">챌린지name</label>
                    </td>
                </tr>
                <tr style="text-align: right;">
                    <!-- <td></td> -->
                    <td colspan="2"><input type="submit" value="작성완료"></td>

                </tr>
            </table>

        </form>

    </div>
</div>


<!-- Footer -->
<th:block th:replace="~{layout/footer::footer}"></th:block>

<!-- Scripts -->

<script th:src="@{/assets/js/browser.min.js}"></script>
<script th:src="@{/assets/js/breakpoints.min.js}"></script>

<script th:src="@{/assets/js/sidebar.js}"></script>
<!--<script th:src="@{/assets/js/profile.js}"></script>-->
<script th:src="@{/assets/js/searchModal.js}"></script>


<script th:src="@{/assets/js/util_sub.js}"></script>
<script th:src="@{/assets/js/main_sub.js}"></script>
<script th:src="@{/assets/js/calender.js}"></script>
<script>
    // $('#summernote').summernote({
    //     // 에디터 높이
    //     height: 150,
    //     // 에디터 한글 설정
    //     lang: "ko-KR",
    //     // 에디터에 커서 이동 (input창의 autofocus라고 생각)
    //     focus : true,
    //     toolbar: [
    //         // 글꼴 설정
    //         ['fontname', ['fontname']],
    //         // 글자 크기 설정
    //         ['fontsize', ['fontsize']],
    //         // 굵기, 기울임꼴, 밑줄,취소 선, 서식지우기
    //         ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
    //         // 글자색
    //         ['color', ['forecolor','color']],
    //         // 표만들기
    //         ['table', ['table']],
    //         // 글머리 기호, 번호매기기, 문단정렬
    //         ['para', ['ul', 'ol', 'paragraph']],
    //         // 줄간격
    //         ['height', ['height']],
    //         // 코드보기, 확대해서보기, 도움말
    //        // ['view', ['codeview','fullscreen', 'help']]
    //     ],
    //     // 추가한 글꼴
    //     fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New','맑은 고딕','궁서','굴림체','굴림','돋음체','바탕체'],
    //     // 추가한 폰트사이즈
    //     fontSizes: ['8','9','10','11','12','14','16','18','20','22','24','28','30','36','50','72']
    //
    // });
</script>
<script>
    function removebf() {
        document.getElementById("bf_result").value = "";
        document.getElementById("bfCal").value = 0;
        document.getElementsByName("todayBf")[0].value = "";

    }

    function removelunch() {
        document.getElementById("lunch_result").value = "";
        document.getElementById("lunchCal").value = 0;
        document.getElementsByName("todaylunch")[0].value = "";

    }

    function removedinner() {
        document.getElementById("dinner_result").value = "";
        document.getElementById("dinnerCal").value = 0;
        document.getElementsByName("todaydinner")[0].value = "";
    }

    function removesnack() {
        document.getElementById("snack_result").value = "";
        document.getElementById("snackCal").value = 0;
        document.getElementsByName("todaysnack")[0].value = "";
    }

    function removeexer() {
        document.getElementById("exer_result").value = "";
        document.getElementById("exerCal").value = 0;
        document.getElementsByName("todayExcrcise")[0].value = "";
    }

    function totalsum() {
        const totalexer = Number(document.getElementById("exerCal").value);
        const bttotal = Number(document.getElementById("bfCal").value);
        const lunchtotal = Number(document.getElementById("lunchCal").value);
        const dinnertal = Number(document.getElementById("dinnerCal").value);
        const snacktotal = Number(document.getElementById("snackCal").value);

        const caloriesGoa = document.getElementById("caloriesGoal").value;
        console.log(caloriesGoa);
        const goalNum = caloriesGoa.slice(0, -4);


        const foodtotal = Number(bttotal + lunchtotal + dinnertal + snacktotal);
        var totalsum = Number(foodtotal - totalexer);
        var todaycal = Number(goalNum - totalsum);
        console.log(foodtotal);
        console.log(totalexer);

        console.log(totalsum);
        document.getElementById("totalFood").value = foodtotal + "kcal";
        document.getElementById("totalexer").value = totalexer + "kcal";
        document.getElementById("totalCal").value = totalsum + "kcal";
        document.getElementById("totalResult").value = totalsum + "kcal";
        document.getElementById("todayCal").value = todaycal + "kcal";

        const todaybfList = $("input[name=todayBf]").val();
        const todayLunchList = $("input[name=todaylunch]").val();
        const todaydinnerList = $("input[name=todaydinner]").val();
        const todaysnackList = $("input[name=todaysnack]").val();

        console.log("아침 :" + todaybfList);
        console.log("점심 :" + todayLunchList);
        console.log("저녁 :" + todaydinnerList);
        console.log("간식 : " + todaysnackList);

        const allListarr = [todaybfList, todayLunchList, todaydinnerList, todaysnackList];
        var todayAllList = "";

        for (var i = 0; i < allListarr.length; i++) {

            if (allListarr[i] != "") {
                todayAllList += (allListarr[i] + ",");
            } else {
                todayAllList += allListarr[i];
            }
        }
        todayAllList = todayAllList.replace(/,$/, '');

        console.log(todayAllList);

        if (todayAllList) {
            $.ajax({
                url: '/calorie/getfoodInfo',
                method: 'POST',
                data: {
                    todayAllList: todayAllList
                },
                dataType: 'json',
                success: function (data) {
                    displayData(data.todayfoodInfo);

                },
                error: function (error) {
                    console.error('데이터를 가져오는 중 오류 발생' + error);
                }

            })
        }

    }

    function displayData(todayfoodInfo) {
        console.log(todayfoodInfo);
        // console.log(todayfoodInfo[0]);
        // console.log(todayfoodInfo[1]);
        // console.log(todayfoodInfo[2]);
        document.getElementById("carbo").value=todayfoodInfo[0]+"g";
        document.getElementById("protein").value=todayfoodInfo[1]+"g";
        document.getElementById("fat").value=todayfoodInfo[2]+"g";
    }

</script>
</body>
</html>