<!DOCTYPE HTML>
<!--
	Slate by Pixelarity
	pixelarity.com | hello@pixelarity.com
	License: pixelarity.com/license
-->
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:tr="http://www.w3.org/1999/html">
<head>
    <title>Fit Hub</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="stylesheet" th:href="@{/assets/css/index.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/sidebar.css}"/>
    <noscript>
        <link rel="stylesheet" th:href="@{/assets/css/noscript.css}"/>
    </noscript>
    <link rel="stylesheet" th:href="@{/assets/css/common.css}"/>

    <link rel="stylesheet" th:href="@{/assets/css/profileModal.css}">
    <link rel="stylesheet" th:href="@{/assets/css/ranking.css}"/>
    <link rel="icon" href="/images/fithub-favicon.png" type="image/png">
</head>
<style>
    .header_box {
        width: 100%;
        background: linear-gradient(to right, rgba(143, 167, 70, 0.25), rgba(143, 167, 70, 0.3)), url(/images/test3.png);
        background-size: cover;
        background-position:  0 65%;
    }
    .wrapper.sidebar > .inner > .inner_main{
        width: 75%;
    }
    #side_box{
        width: 25%;
    }
    #side_box table tbody tr:nth-child(2n + 1) {
        background-color: #FFFFFF;
    }

    .top_img_box {
        width: 100%;
        height: 310px;
        margin-bottom: 50px;
        background-color: red;
    }

    .top_img_box > img {
        width: 100%;
        height: 100%;
    }

    #main {
        padding: 0;
    }

    .wrapper {
        padding: 0;
        margin-bottom: 100px;
    }

    #header {
    <!-- background-color: #5a8100;
    -->
    }

    #header nav > ul > li a {
        color: white;
    }

    #header h1 a {
        color: white;
    }

    #header .main ul li > a {
        color: white;

    }

    #footer {
        background-color: #304400;
    }

    .ranking_box_view{
        width: 194px; height: 198px;
        margin-bottom: 20px;
    }


    /* CSS */
    .trainerRanking {
        border-collapse: collapse;
        display: flex;
    }

    .trainerRanking td {
        text-align: center;
        padding: 10px;

        flex-grow: 1;
    }

    .trainerRanking img {
        width: 100%;
        height: auto;
        display: block; /* 이미지가 줄 바꿈 없이 나타나도록 합니다. */
        margin-bottom: 5px; /* 이미지와 닉네임 간격 조절 */
    }

    .trainerRanking span {
        display: block;
        background-color: #ebede1 !important;
    }

    .trainerRanking span {
        display: block;
        background-color: #ebede1 !important;
    }


    .rank_number th {
        height: 50px;
        font-size: 20px;
        font-weight: bold;
    }


    .Ma_write tr {
        background-color: white !important;
        border: none !important;
    }

    .write {
        width: 150px;
        height: 50px;
        border-radius: 10px;
        float: right;
        font-weight: bold;
        background-color: skyblue;
        text-align: center;
        line-height: 50px;
        vertical-align: middle;
        position: relative;
        top: 30px;
    }

    #map {
        margin-bottom: 50px;
    }

    .ma_title {
        background-color: white !important;
        text-align: left;

    }

    #list_table {
        display: flex;
        width: 864px;
    }

    #list_info {
        width: 100%;
    }

    .profile-file {
        border: 1px solid black;
        width: 200px;
        height: 152.469px;
    }

    .open:hover {
        color: #5a8100;
        font-weight: bold;
        cursor: pointer !important;
    }

    #list_table:hover {
        transform: scale(1.02);
        transition: transform 0.2s;
    }

    .search_area {
        display: flex;
    }

    .search_area select {
        width: 150px;
    }

    .rankBox table tr td {
        /*text-align: center;*/
        background: #FFFFFF;
        overflow: hidden;
        text-overflow: ellipsis
    }

    .rankBox table tr td {
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 160px;
    }


    .customoverlay {
        position: relative;
        bottom: 85px;
        border-radius: 6px;
        border: 1px solid #ccc;
        border-bottom: 2px solid #ddd;
        float: left;
    }

    .customoverlay:nth-of-type(n) {
        border: 0;
        box-shadow: 0px 1px 2px #888;
    }

    .customoverlay a {
        display: block;
        text-decoration: none;
        color: #000;
        text-align: center;
        border-radius: 6px;
        font-size: 14px;
        font-weight: bold;
        overflow: hidden;
        background: #d95050;
        background: #d95050 url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/arrow_white.png) no-repeat right 14px center;
    }

    .customoverlay .title {
        display: block;
        text-align: center;
        background: #fff;
        margin-right: 35px;
        padding: 10px 15px;
        font-size: 14px;
        font-weight: bold;
    }

    .customoverlay:after {
        content: '';
        position: absolute;
        margin-left: -12px;
        left: 50%;
        bottom: -12px;
        width: 22px;
        height: 12px;
        background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white.png')
    }
    a.btnColor{
        background: #FFFFFF;
        border: 1px solid #5a8100;
        border-radius: 4px;
        color: #5a8100 !important;
        box-shadow: 4px 4px 2px 0px rgb(203,211,177);

    }
    a.btnColor:hover{
        background: #5a8100;
        border: 1px solid #5a8100;
        border-radius: 4px;
        color: #F7FAF5 !important;
        box-shadow: 0 0 2px #5a8100;

    }


</style>

<!-- Header -->
<th:block
        th:replace="~{layout/header::header(${session.loginUser},${session.user},${session.trainer},${session.admin},${session.profile})}"></th:block>

<!-- Modal -->
<th:block th:replace="~{layout/profileModal::profileModal}"></th:block>
<!-- Main -->
<section id="main" class="wrapper sidebar left">

    <div class="header_box">
        <header class="test12">
            <p id="mainText">트레이너 매칭</p>
            <p id="subText">매칭 페이지</p>
        </header>
    </div>

    <div class="inner">

        <div class="inner_main">
            <!-- Content -->
            <div class="content">
                <div class="ranking_box">
                    <h2>최근 등록한 트레이너</h2>
                    <div>
                        <table class="trainerRanking">
                            <tr class="rank_number">
                                <th>1.</th>
                                <th>2.</th>
                                <th>3.</th>
                                <th>4.</th>
                            </tr>
                            <tr th:if="${list != null and list.size() > 0}">
                                <td th:each="board, iterStat : ${list}" th:if="${iterStat.index < 4}">
                                    <div class="ranking_box_view" >
                                        <th:block th:if="${board.profileInfo != null}">
                                            <img style="width:100%; height:100%;"
                                                 th:src="@{/matching/thumbnail (sysName=${board.profileInfo.sysName})}">
                                        </th:block>
                                        <a href="#" class="open"><span
                                                th:text="${board.trainerInfo.trainerNickname}"></span></a>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="trainer_box">
                    <table class="Ma_write">
                        <tr align="right" valign="middle">
                            <td><h2 class="ma_title">나에게 맞는 트레이너를 매칭해보세요</h2></td>
                            <td>
                                <th:block th:if="${session.trainer != null}">
                                    <a class="write btnColor" href="/matching/matching_write">글쓰기</a>
                                </th:block>
                            </td>
                        </tr>
                    </table>

                        <div id="map" style="width:100%;height:350px;"></div>
                    <th:block th:if="${list != null and list.size() > 0}" th:each="board : ${list}">
                        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
                        <script type="text/javascript"
                                src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=9d457fe0b04b983671f48d03d84f2fdb&libraries=services"></script>
                        <script>

                            var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                                mapOption = {
                                    center: new kakao.maps.LatLng(37.5125, 127.102778), // 지도의 중심좌표
                                    level: 4 // 지도의 확대 레벨
                                };

                            // 지도를 생성합니다
                            var map = new kakao.maps.Map(mapContainer, mapOption);

                            // 주소-좌표 변환 객체를 생성합니다
                            var geocoder = new kakao.maps.services.Geocoder();

                            $.ajax({
                                url: '/matching/map?boardNum=[[${board.boardNum}]]',
                                method: 'GET',
                                success: function(data) {

                                     var parsedData = JSON.parse(data);
                                      // console.log(parsedData);
                                    // parsedData를 순회하면서 처리
                                    parsedData.boardList.forEach(function(boardData) {
                                    var address = boardData.TrainerAddr;
                                    //console.log(address);
                                    var trainerNickname = boardData.trainerNickname;
                                    //console.log(trainerNickname);
                                    // 주소로 좌표를 검색합니다
                                    geocoder.addressSearch(address, function(result, status) {

                                    // 정상적으로 검색이 완료됐으면
                                     if (status === kakao.maps.services.Status.OK) {

                                        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                                        // 결과값으로 받은 위치를 마커로 표시합니다
                                        var marker = new kakao.maps.Marker({
                                            map: map,
                                            position: coords
                                        });

                                        // 인포윈도우로 장소에 대한 설명을 표시합니다
                                        var infowindow = new kakao.maps.InfoWindow({

                                            content: '<div style="width:150px;text-align:center;padding:6px 0;background-color: #d6d6d6 !important;border:1px solid gray">' + trainerNickname + '</div>'
                                        });
                                        infowindow.open(map, marker);

                                        // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                                        map.setCenter(coords);
                                           } // 괄호 닫히는 부분 추가
                                        }); // addressSearch 함수 괄호 닫히는 부분 추가
                                    });
                                },
                                error: function(err) {
                                    console.error('Error fetching data:', err);
                                }
                            });
                        </script>
                    </th:block>
                </div>

            </div>

            <div class="TrainerMatching_box">
                <div class="matching_list">
                    <div class="list_hover">
                        <th:block th:if="${list != null and list.size() > 0}" th:each="board : ${list}">
                            <a class="get" th:href="${board.boardNum}">
                                <div id="list_table">
                                    <table id="list_info">
                                        <tr>
                                            <th id="trainerNickname" colspan="2">
                                                <a href="#" class="open"><span
                                                        th:text="${board.trainerInfo.trainerNickname}"></span></a>
                                            </th>
                                            <td>
                                            <span style="font-size: smaller;">조회수: <span
                                                    th:text="${board.viewCnt}"></span></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td  colspan="2">
                                                <span th:if="${board.starRatingAv != null}">
                                                    별점 : <span th:text="${board.starRatingAv}">점</span>
                                                </span>
                                                <span th:unless="${board.starRatingAv != null}">
                                                작성된 리뷰가 없습니다
                                                </span>
                                            </td>
                                            <td id="trainerCareer">
                                                <span th:text="${board.trainerInfo.trainerCareer}"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">[[${board.boardTitle}]]</td>

                                            <td><img src="/images/like_off.png" style="width:17px;"> <span th:text="${board.likeCnt}"></span></td>
                                        </tr>
                                    </table>
                                    <div class="profile-file">
                                        <th:block th:if="${board.profileInfo != null}">
                                            <img style="width:100%; height:100%;"
                                                 th:src="@{/matching/thumbnail (sysName=${board.profileInfo.sysName})}">
                                        </th:block>
                                    </div>
                                    <th:block th:if="${list == null or list.size() == 0}">
                                        <tr>
                                            <td colspan="4" style="text-align: center; font-size: 20px;">등록된
                                                게시글이 없습니다.
                                            </td>
                                        </tr>
                                    </th:block>
                                </div>
                            </a>
                        </th:block>
                        <br>
                        <table class="pagination none_color_table">
                            <tr align="center" valign="middle">
                                <td>
                                    <a class="changePage" th:if="${pageMaker.prev}"
                                       th:href="${pageMaker.startPage-1}">&lt;</a>
                                    <th:block th:each="i : ${#numbers.sequence(pageMaker.startPage,pageMaker.endPage)}">
                                        <span class="nowPage" th:text="${i}"
                                              th:if="${pageMaker.cri.pagenum == i}"></span>
                                        <a class="changePage" th:href="${i}" th:text="${i}"
                                           th:unless="${pageMaker.cri.pagenum == i}"></a>
                                    </th:block>
                                    <a class="changePage" th:if="${pageMaker.next}"
                                       th:href="${pageMaker.endPage+1}">&gt;</a>
                                </td>
                            </tr>
                        </table>
<!--
                        <form id="searchForm" th:action="@{/matching/matching_list}">
                            <div class="search_area">
                                <select name="type">
                                    <option value="" th:selected="${pageMaker.cri.type == null}">검색</option>
                                    <option value="T" th:selected="${pageMaker.cri.type == 'T'}">제목</option>
                                    <option value="C" th:selected="${pageMaker.cri.type == 'C'}">내용</option>
                                    <option value="W" th:selected="${pageMaker.cri.type == 'W'}">작성자</option>
                                    <option value="TC" th:selected="${pageMaker.cri.type == 'TC'}">제목 또는 내용</option>
                                    <option value="TW" th:selected="${pageMaker.cri.type == 'TW'}">제목 또는 작성자</option>
                                    <option value="TCW" th:selected="${pageMaker.cri.type == 'TCW'}">제목 또는 내용 또는 작성자
                                    </option>
                                </select>
                                <input type="text" style="margin-right: 20px" name="keyword" id="keyword" th:value="${pageMaker.cri.keyword}">
                                <a href="#" class="button btnColor primary">검색</a>
                            </div>
                            <input type="hidden" value="1" name="pagenum">
                            <input type="hidden" value="10" name="amount">
                        </form>
-->
                    </div>
                </div>
            </div>
        </div>
        <th:block th:replace="~{layout/rank_sidebar::sidebar}"></th:block>
    </div>
    <form name="pageForm" id="pageForm" th:action="@{/matching/matching_list}">
        <input type="hidden" name="pagenum" th:value="${pageMaker.cri.pagenum}">
        <input type="hidden" name="amount" th:value="${pageMaker.cri.amount}">
        <input type="hidden" name="type" th:value="${pageMaker.cri.type}">
        <input type="hidden" name="keyword" th:value="${pageMaker.cri.keyword}">
    </form>
    </div>

</section>

<!-- Footer -->
<th:block th:replace="~{layout/footer::footer}"></th:block>

<!-- Scripts -->
<script th:src="@{/assets/js/jquery.min.js}"></script>
<script th:src="@{/assets/js/jquery.dropotron.min.js}"></script>
<script th:src="@{/assets/js/jquery.scrollex.min.js}"></script>
<script th:src="@{/assets/js/browser.min.js}"></script>
<script th:src="@{/assets/js/breakpoints.min.js}"></script>
<script th:src="@{/assets/js/util.js}"></script>
<script th:src="@{/assets/js/main.js}"></script>

<script th:src="@{/assets/js/util_sub.js}"></script>
<script th:src="@{/assets/js/main_sub.js}"></script>


<script th:src="@{/assets/js/profile.js}"></script>
<script th:src="@{/assets/js/map_sub.js}"></script>


<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</body>
<script th:inline="javascript">
    const searchForm = $("#searchForm");
    const pageForm = $("#pageForm");

    $(".changePage").on("click", function (e) {
        //e(이벤트)의 기본 작동 막기
        e.preventDefault();
        let pagenum = $(this).attr("href");
        pageForm.find("input[name='pagenum']").val(pagenum);
        pageForm.submit();
    });

    $(".get").on("click", function (e) {
        e.preventDefault();
        let boardNum = $(this).attr("href");
        let url =/*[[@{/matching/matching_view}]]*/'';
        console.log(boardNum);
        pageForm.append("<input type='hidden' name='boardNum' value='" + boardNum + "'>")
        pageForm.attr("action", url);
        pageForm.attr("method", "get");
        pageForm.submit();
    })

    $("#searchForm a").on("click", sendit);

    function sendit() {
        if (!searchForm.find("option:selected").val()) {
            alert("검색 기준을 선택하세요!");
            return false;
        }
        if (!$("input[name='keyword']").val()) {
            alert("키워드를 입력하세요!");
            return false;
        }
        searchForm.submit();
    }

    $(document).ready(function () {
        $(".open").click(function (e) {
            e.stopPropagation();
            e.preventDefault(); // 기본 동작 방지 (링크 이동 취소)
            // 여기에 원하는 동작 추가
        });
    });

    $(".open").on("click", function (e) {
        e.preventDefault();
        var userId = $(this).text();

        sendUserIdToModal(userId);
        modalBox.classList.add("active");
    });


</script>
</html>