<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.demo.mapper.UserMyPageMapper">

	<sql id="cri">
		<if test="keyword != '' and type != ''">
			<trim prefixOverrides="or" prefix="(" suffix=") and">
				<foreach collection="typeArr" item="type">
					or
					<choose>
						<when test="type == 'T'.toString()">
							(board_title like('%${keyword}%'))
						</when>
						<when test="type == 'C'.toString()">
							(board_content like('%${keyword}%'))
						</when>
						<when test="type == 'W'.toString()">
							(user_id like('%${keyword}%'))
						</when>
					</choose>
				</foreach>
			</trim>
		</if>
	</sql>

	<insert id="registDiary">
		insert into diary (user_id,today_weight,exer_calories,food_calories,today_exer,today_breakfast,today_lunch,today_dinner,today_snack,carbo,protein,fat,regdate,diary_title,diary_content,mychall_num)
		values(#{userId},#{todayWeight},#{exerCalories},#{foodCalories},#{todayExer},#{todayBreakfast},#{todayLunch},#{todayDinner},#{todaySnack},#{carbo},#{protein},#{fat},#{reddate},#{diaryTitle},#{diaryContent},#{todayChallNum});
	</insert>

	<update id="modifyDiary">
		update diary set today_weight=#{todayWeight},exer_calories=#{exerCalories},food_calories=#{foodCalories},today_exer=#{todayExer},today_breakfast=#{todayBreakfast},today_lunch=#{todayLunch},today_dinner=#{todayDinner},
						 today_snack=#{todaySnack},carbo=#{carbo},protein=#{protein},fat=#{fat},diary_title=#{diaryTitle},diary_content=#{diaryContent},mychall_num=#{todayChallNum} where diary_num=#{diaryNum}
	</update>

	<delete id="removeDiary">
		delete from diary where diary_num=#{diaryNum}
	</delete>

	<select id="getDiaryDetail">
		select * from diary where user_id = #{loginUser} and regdate=#{choicedate}
	</select>

	<select id="checkList">
		select * from diary where user_id = #{loginUser} and regdate=#{choicedate}
	</select>



	<!--재우-->
	<!--메세지-->
	<select id="getMyMessageAll">
		select * from message where send_id=#{userId} or receive_id=#{userId}
		order by message_num desc limit #{cri.startrow},#{cri.amount}
	</select>

	<select id="getMyMessageSend">
		select * from message where send_id=#{userId}
		order by message_num desc limit #{cri.startrow},#{cri.amount}
	</select>

	<select id="getMyMessageReceive">
		select * from message where receive_id=#{userId}
		order by message_num desc limit #{cri.startrow},#{cri.amount}
	</select>

	<select id="getMessageTotal">
		select count(*) from message where  send_id=#{userId} or receive_id=#{userId} and
		message_num > 0
	</select>
	<select id="getMessageTotalSend">
		select count(*) from message where  send_id=#{userId} and
		message_num > 0
	</select>
	<select id="getMessageTotalReceive">
		select count(*) from message where receive_id=#{userId} and
		message_num > 0
	</select>

	<select id="getMessageLastNum">
		select max(message_num) from message where user_id=#{userId}
	</select>

	<!--보드-->
	<select id="getBoardTotal">
		select count(*) from board where user_id=#{userId} and
		board_num > 0
	</select>
	<select id="getBoardLastNum">
		select max(board_num) from board where user_id=#{userId}
	</select>
	<select id="findBoardByNum">
		select * from board where board_num=#{boardNum}
	</select>


	<select id="getMyBoard">
		select * from board where user_id=#{userId}
		order by board_num desc limit #{cri.startrow},#{cri.amount}
	</select>

	<!--북마크-->
	<!--bookmark_idx : regdate 로 수정 필요 : 임시값이 null이라 오류로 인해-->
	<select id="getBookmarkTotal">
		select count(*) from bookmark where user_id=#{userId} and
		(board_category='infoNew' or board_category='infoExer' or board_category ='infoFood' or board_category='tip'
		or board_category='comFree' or board_category='comExer' or board_category='comFood' or board_category='comPhoto'
		or board_category='comQna')
		and	regdate > 0
	</select>

	<select id="getBookmarkProductTotal">
		select count(*) from bookmark where user_id=#{userId} and (board_category='prodExer' or board_category='prodFood')
		and regdate > 0
	</select>

	<select id="getBookmarkLastNum">
		select max(bookmark_num) from bookmark where user_id=#{userId}
	</select>

	<!--<select id="getMyBookmark">
		select * from bookmark where user_id=#{userId}
	</select>-->

	<select id="getMyBookmark">
		select * from board,bookmark where bookmark.user_id=#{userId}
		and board.board_category =bookMark.board_category and board.board_num=bookMark.board_num
		order by bookmark.regdate desc limit #{cri.startrow},#{cri.amount}

	</select>
	<select id="getMyBookmarkProduct">
		select * from product_board,bookmark where bookmark.user_id=#{userId}
		and product_board.category =bookMark.board_category and product_board.board_num=bookMark.board_num
		order by bookmark.regdate desc limit #{cri.startrow},#{cri.amount}
	</select>

	<!--내구독-->
	<select id="getMyScribe">
		select * from trainer join subscribe on subscribe.trainer_id = trainer.trainer_id
		where subscribe.user_id = #{userId}
		order by subscribe.sub_date desc limit #{cri.startrow},#{cri.amount}
	</select>

	<select id="getScribeTotal">
		select count(*) from subscribe where user_id=#{userId} and
		sub_num > 0
	</select>

	<!--내 챌린지-->
<!--	<select id="getChallengeTotal">
		select count(my_challenge.chall_num) from my_challenge
		join chall_notice_board on chall_notice_board.chall_num = my_challenge.chall_num
		where my_challenge.user_id=#{userId} and
		my_challenge.mychall_num > 0
	</select>-->

	<select id="getChallengeAllAllTotal">
		select count(my_challenge.chall_num) from my_challenge
		join chall_notice_board on chall_notice_board.chall_num = my_challenge.chall_num
		where my_challenge.user_id = #{userId} and
		my_challenge.mychall_num > 0
	</select>

	<select id="getChallengeAllTermTotal">
		select count(my_challenge.chall_num) from my_challenge
		join chall_notice_board on chall_notice_board.chall_num = my_challenge.chall_num
		where my_challenge.user_id = #{userId} and chall_notice_board.chall_term = #{challTerm} and
		my_challenge.mychall_num > 0
	</select>

	<select id="getChallengeCategoryAllTotal">
		select count(my_challenge.chall_num) from my_challenge
		join chall_notice_board on chall_notice_board.chall_num = my_challenge.chall_num
		where my_challenge.user_id = #{userId} and chall_notice_board.chall_category =#{challCategory} and
		my_challenge.mychall_num > 0
	</select>

	<select id="getChallengeCategoryTermTotal">
		select count(my_challenge.chall_num) from my_challenge
		join chall_notice_board on chall_notice_board.chall_num = my_challenge.chall_num
		where my_challenge.user_id = #{userId} and chall_notice_board.chall_term = #{challTerm} and chall_notice_board.chall_category =#{challCategory} and
		my_challenge.mychall_num > 0
	</select>
<!--	<select id="getMyChallenge">
		select * from chall_notice_board
		join my_challenge on my_challenge.chall_num = chall_notice_board.chall_num
		where my_challenge.user_id = #{userId}
		order by my_challenge.sub_regdate desc limit #{cri.startrow},#{cri.amount}
	</select>-->
	<select id="getMyChallengeAllAll">
		select * from chall_notice_board
		join my_challenge on my_challenge.chall_num = chall_notice_board.chall_num
		where my_challenge.user_id = #{userId}
		order by my_challenge.sub_regdate desc limit #{cri.startrow},#{cri.amount}
	</select>

	<select id="getMyChallengeAllTerm">
		select * from chall_notice_board
		join my_challenge on my_challenge.chall_num = chall_notice_board.chall_num
		where my_challenge.user_id = #{userId} and chall_notice_board.chall_term =#{challTerm}
		order by my_challenge.sub_regdate desc limit #{cri.startrow},#{cri.amount}
	</select>

	<select id="getMyChallengeCategoryAll">
		select * from chall_notice_board
		join my_challenge on my_challenge.chall_num = chall_notice_board.chall_num
		where my_challenge.user_id = #{userId} and chall_notice_board.chall_category = #{challCategory}
		order by my_challenge.sub_regdate desc limit #{cri.startrow},#{cri.amount}
	</select>

	<select id="getMyChallengeCategoryTerm">
		select * from chall_notice_board
		join my_challenge on my_challenge.chall_num = chall_notice_board.chall_num
		where my_challenge.user_id = #{userId} and chall_notice_board.chall_term = #{challTerm} and chall_notice_board.chall_category = #{challCategory}
		order by my_challenge.sub_regdate desc limit #{cri.startrow},#{cri.amount}
	</select>


	<!--트레이너 신청-->
	<insert id= "insertApplytrainer">
		INSERT INTO trainer_signup (user_id, trainer_zipcode, trainer_addr, trainer_addrdetail, trainer_addretc, trainer_part, trainer_career, trainer_content)
		VALUES
		(#{userId}, #{trainerZipcode}, #{trainerAddr}, #{trainerAddrdetail},#{trainerAddretc}, #{trainerPart}, #{trainerCareer}, #{trainerContent})
	</insert>

	<select id="getSignUpLastNum">
		select max(signup_num) from trainer_signup where user_id=#{userId}
	</select>


</mapper>







